<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>外汇交易现金流期限汇总报告</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        th:first-child, td:first-child {
            text-align: left;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .metric-card {
            text-align: center;
            padding: 20px;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
        }
        .metric-label {
            color: #666;
            margin-top: 5px;
        }
        .positive {
            color: green;
        }
        .negative {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>外汇交易现金流期限汇总报告</h1>
        
        <div class="dashboard">
            <div class="card">
                <h3>按期限汇总现金流</h3>
                <table id="periodTable">
                    <thead>
                        <tr>
                            <th>期限</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><th>Period</th><th>CNY</th><th>EUR</th><th>GBP</th><th>JPY</th><th>USD</th></tr>
<tr><td>Today</td><td>0.00</td><td>1,000,000.00</td><td>5,000,000.00</td><td>-600,000,000.00</td><td>-1,100,000.00</td></tr>
<tr><td>Next 1W</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td></tr>
<tr><td>Next 1M</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td></tr>
<tr><td>Next 3M</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td></tr>
<tr><td>Next 6M</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td></tr>
<tr><td>Next 1Y</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td></tr>
<tr><td>Beyond 1Y</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td><td>0.00</td></tr>

                    </tbody>
                </table>
            </div>
            
            <div class="card">
                <h3>损益汇总</h3>
                <div id="pnlChart" style="height: 200px; background: #f9f9f9; margin: 10px 0; display: flex; align-items: flex-end; justify-content: space-around; padding: 10px;">
                    <!-- P&L图表将通过JavaScript生成 -->
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>货币</th>
                            <th>P&L</th>
                        </tr>
                    </thead>
                    <tbody id="pnlTableBody">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="card">
            <h3>即期汇率参考</h3>
            <table>
                <thead>
                    <tr>
                        <th>货币对</th>
                        <th>即期汇率</th>
                    </tr>
                </thead>
                <tbody id="fxRatesBody">
                </tbody>
            </table>
        </div>
        
        <script>
            // 页面加载完成后执行
            document.addEventListener('DOMContentLoaded', function() {
                // P&L数据 (从模板传入)
                const pnlItems = [];
                // 修复fxRates格式
                const fxRatesRaw = "[['EURUSD', 1.17755], ['USDJPY', 149.8195], ['USDCNY', 7.010615], ['GBPJPY', 187.385]]";
                let fxRates = [];
                try {
                    // 尝试直接解析为数组
                    fxRates = [['EURUSD', 1.17755], ['USDJPY', 149.8195], ['USDCNY', 7.010615], ['GBPJPY', 187.385]];
                } catch(e) {
                    console.log("Failed to parse fxRates as array");
                }
                
                // 生成P&L表格行
                const pnlTableBody = document.getElementById('pnlTableBody');
                if (pnlItems.length > 0) {
                    pnlItems.forEach(function(item) {
                        const row = document.createElement('tr');
                        const currencyCell = document.createElement('td');
                        const pnlCell = document.createElement('td');
                        
                        currencyCell.textContent = item[0];
                        pnlCell.textContent = item[1].toFixed(2);
                        
                        // 根据数值正负添加颜色类
                        if (item[1] > 0) {
                            pnlCell.classList.add('positive');
                        } else if (item[1] < 0) {
                            pnlCell.classList.add('negative');
                        }
                        
                        row.appendChild(currencyCell);
                        row.appendChild(pnlCell);
                        pnlTableBody.appendChild(row);
                    });
                } else {
                    const row = document.createElement('tr');
                    const cell = document.createElement('td');
                    cell.setAttribute('colspan', '2');
                    cell.textContent = '无P&L数据';
                    row.appendChild(cell);
                    pnlTableBody.appendChild(row);
                }
                
                // 生成即期汇率表格行
                const fxRatesBody = document.getElementById('fxRatesBody');
                if (fxRates.length > 0) {
                    fxRates.forEach(function(rate) {
                        const row = document.createElement('tr');
                        const pairCell = document.createElement('td');
                        const rateCell = document.createElement('td');
                        
                        pairCell.textContent = rate[0];
                        rateCell.textContent = rate[1].toFixed(6);
                        
                        row.appendChild(pairCell);
                        row.appendChild(rateCell);
                        fxRatesBody.appendChild(row);
                    });
                } else {
                    const row = document.createElement('tr');
                    const cell = document.createElement('td');
                    cell.setAttribute('colspan', '2');
                    cell.textContent = '无即期汇率数据';
                    row.appendChild(cell);
                    fxRatesBody.appendChild(row);
                }
                
                // 生成P&L柱状图
                const pnlChart = document.getElementById('pnlChart');
                if (pnlItems.length > 0) {
                    // 找到最大绝对值用于缩放
                    const maxAbsPnl = Math.max(...pnlItems.map(item => Math.abs(item[1])));
                    
                    pnlItems.forEach(function(item) {
                        const barContainer = document.createElement('div');
                        barContainer.style.display = 'flex';
                        barContainer.style.flexDirection = 'column';
                        barContainer.style.alignItems = 'center';
                        barContainer.style.flex = '1';
                        
                        const valueLabel = document.createElement('div');
                        valueLabel.textContent = item[0];
                        valueLabel.style.marginBottom = '5px';
                        valueLabel.style.fontSize = '0.8em';
                        
                        const bar = document.createElement('div');
                        const heightPercent = maxAbsPnl > 0 ? Math.abs(item[1]) / maxAbsPnl * 80 : 0;
                        bar.style.width = '30px';
                        bar.style.height = heightPercent + '%';
                        bar.style.backgroundColor = item[1] >= 0 ? '#4CAF50' : '#f44336';
                        bar.style.borderRadius = '4px';
                        bar.style.position = 'relative';
                        
                        const barValue = document.createElement('div');
                        barValue.textContent = item[1] > 0 ? '+' + item[1].toFixed(0) : item[1].toFixed(0);
                        barValue.style.position = 'absolute';
                        barValue.style.bottom = item[1] >= 0 ? '100%' : 'auto';
                        barValue.style.top = item[1] < 0 ? '100%' : 'auto';
                        barValue.style.left = '50%';
                        barValue.style.transform = 'translateX(-50%)';
                        barValue.style.fontSize = '0.7em';
                        barValue.style.color = item[1] >= 0 ? '#4CAF50' : '#f44336';
                        barValue.style.fontWeight = 'bold';
                        
                        bar.appendChild(barValue);
                        barContainer.appendChild(valueLabel);
                        barContainer.appendChild(bar);
                        pnlChart.appendChild(barContainer);
                    });
                } else {
                    pnlChart.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; width: 100%;">无P&L数据</div>';
                }
            });
        </script>
    </div>
</body>
</html>